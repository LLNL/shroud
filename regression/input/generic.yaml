copyright:
- Copyright (c) 2017-2020, Lawrence Livermore National Security, LLC and
- other Shroud Project Developers.
- See the top-level COPYRIGHT file for details.
-
- "SPDX-License-Identifier: (BSD-3-Clause)"
-

# Test fortran_generic

library: generic
cxx_header: generic.h helper.h
language: c

options:
  debug: True
  wrap_python: False
  wrap_lua: False
  literalinclude2: True

declarations:

- decl: double GetGlobalDouble()

- decl: void GenericReal(double arg)
  options:
    literalinclude: True
  doxygen:
    brief: Single argument generic
  fortran_generic:
  - decl: (float arg)
    function_suffix: _float
  - decl: (double arg)
    function_suffix: _double

- decl: long GenericReal2(long arg1, long arg2)
  doxygen:
    brief: Two argument generic
    description: |
      It is not possible to call the function with (int, long)
      or (long, int)
  fortran_generic:
  - decl: (int arg1, int arg2)
    function_suffix: _all_int
  - decl: (long arg1, long arg2)
    function_suffix: _all_long

- decl: void SavePointer(void *addr, int type, size_t size+implied(size(addr)))
  # cannot use size as an dummy argument name
  # Add deref(raw) attribute to Fortan function.
  # This will take the C_LOC of the variable in order to get a 'void *'
  # for the C interface.
  cpp_if: if 1
  fortran_generic:
  - decl: (float *addr+rank(1)+deref(raw),    int type+implied(T_FLOAT))
    function_suffix: _float1d
  - decl: (float *addr+rank(2)+deref(raw),  int type+implied(T_FLOAT))
    function_suffix: _float2d

#  - decl: (double *addr+rank(1),   int type+implied(T_DOUBLE))
#  - decl: (double *addr+rank(2), int type+implied(T_DOUBLE))


- decl: void SavePointer2(void *addr, int type+implied(type(addr)), size_t size+implied(size(addr)))
  fstatements:
    c:
      c_helper: ShroudTypeDefines
      pre_call:
      - // Test adding a blank line below.
      -
      - type = convert_type(type);
  fortran_generic:
  - decl: (float *addr+rank(1)+deref(raw))
    function_suffix: _float1d
  - decl: (float *addr+rank(2)+deref(raw))
    function_suffix: _float2d

#  - decl: (double *addr+rank(1), int type+implied(T_DOUBLE))
#  - decl: (double *addr+rank(2), int type+implied(T_DOUBLE))


- decl: void GetPointer(void **addr+intent(out),
                        int *type+intent(out),
                        size_t *size+intent(out))
- decl: void GetPointerAsPointer(
               void **addr+intent(out),
               int *type+intent(out)+hidden,
               size_t *size+intent(out)+hidden)
  cpp_if: if 0
  fortran_generic:
  - decl: (float **addr+intent(out)+rank(1)+deref(pointer))
    function_suffix: _float1d
  - decl: (float **addr+intent(out)+rank(2)+deref(pointer))
    function_suffix: _float2d


splicer_code:
  f:
    module_top:
    -  "integer, parameter :: T_INT = 1"
    -  "integer, parameter :: T_LONG = 2"
    -  "integer, parameter :: T_FLOAT = 3"
    -  "integer, parameter :: T_DOUBLE = 4"
