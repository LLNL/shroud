copyright:
- Copyright Shroud Project Developers. See LICENSE file for details.
-
- "SPDX-License-Identifier: (BSD-3-Clause)"
-

# Create an executable program for typedefs
# C source to enable testing of typedefs with struct/enum tags.

library: typedefs
cxx_header: typedefs.h

options:
  debug: True
  wrap_python: True
  PY_struct_arg: list
  literalinclude: True

declarations:

# Using a typedef as an alias
- decl: typedef int Alias;
- decl: Alias typefunc(Alias arg);

- decl: Alias typefunc_wrap(Alias arg);
  options:
    C_force_wrapper: True
    wrap_python: False
    wrap_lua: False
  doxygen:
    brief: Use typedef with a C wrapper
    description: |
      Use C_force_wrapper to ensure the typedef will be used
      in the C wrapper.

#####
# Pass an enum via a typedef
# enum from enum.yaml

- decl: |
      enum Color {
        RED = 10,
        BLUE,
        WHITE
      };
  splicer:
    f: |
       integer(color), parameter :: &
         red=10, blue=11, white=12
    c: |
       TYP_RED = 10,
       TYP_BLUE = 11,
       TYP_WHITE = 12

- decl: typedef enum Color iColor;

- decl: iColor returnEnum(iColor in);

#####

- decl: |
      enum DataTypeID
      {
        NO_TYPE_ID = SHARED_NO_TYPE_ID,
        INT_ID = SHARED_INT_ID,
        LONG_ID = SHARED_LONG_ID,
        FLOAT_ID = SHARED_FLOAT_ID,
        DOUBLE_ID = SHARED_DOUBLE_ID
      };

- decl: typedef enum DataTypeID TypeID;

- decl: TypeID returnTypeID(TypeID in);

#####

# struct typedef
- decl: struct s_Struct1 {
          int i;
          double d;
        };
- decl: typedef struct s_Struct1 Struct1Rename;
- decl: void typestruct(Struct1Rename *arg1);

######################################################################
#
# Use the Shroud default names, TYP_IndexType and INDEX_TYPE, in the splicer

- decl: typedef int32_t IndexType
  splicer:
    c: |
      #if defined(USE_64BIT_INDEXTYPE)
      typedef int64_t TYP_IndexType;
      #else
      typedef int32_t TYP_IndexType;
      #endif
    f: |
      #if defined(USE_64BIT_INDEXTYPE)
      integer, parameter :: INDEX_TYPE = C_INT64_T
      #else
      integer, parameter :: INDEX_TYPE = C_INT32_T
      #endif

- decl: int returnBytesForIndexType(IndexType arg);
  options:
    wrap_python: False

- decl: IndexType returnShapeSize(int ndims,
                                  const IndexType *shape+intent(in)+rank(1));
  options:
    wrap_python: False

#####
# Define a typedef but change the names of the generated types

- decl: typedef int32_t IndexType2
  format:
    F_name_typedef: LOCAL_Index_Type
    C_name_typedef: LOCAL_IndexType
  splicer:
    c: |
      #if defined(USE_64BIT_INDEXTYPE)
      typedef int64_t LOCAL_IndexType;
      #else
      typedef int32_t LOCAL_IndexType;
      #endif
    f: |
      #if defined(USE_64BIT_INDEXTYPE)
      integer, parameter :: LOCAL_INDEX_TYPE = C_INT64_T
      #else
      integer, parameter :: LOCAL_INDEX_TYPE = C_INT32_T
      #endif

- decl: int returnBytesForIndexType2(IndexType2 arg);
  options:
    wrap_python: False

- decl: IndexType2 returnShapeSize2(int ndims,
                                    const IndexType2 *shape+intent(in)+rank(1));
  options:
    wrap_python: False

######################################################################

# Add code which will be integrated with other include and use statements
# added by typemaps and statements.
file_code:
#  wraptypemap.h:
#    c_header: <stdint.h>
#    cxx_header: <cstdint>
  wrapftypedefs.f:
    f_module:
      iso_c_binding:
      - C_INT32_T
      - C_INT64_T

splicer_code:
  c:
    C_declarations: |
      #include "shared.h"
  f:
    file_top: |
      #include "shared.h"